version: v1beta9
deployments:
  - name: backend
    namespace: tqtezos
    kubectl:
      manifests:
        - ./backend.yaml
images:
  server:
    image: rpc-auth
    dockerfile: ./Dockerfile
    context: ./
    build:
      docker:
        options:
          target: ${PYTHON_ENV}
dev:
  sync:
    - imageName: server
      namespace: tqtezos
      labelSelector:
        app: rpc-auth
  autoReload:
    images:
      - server
    deployments:
      - backend
hooks:
  - command: minikube
    args:
      - addons
      - enable
      - ingress
    when:
      before:
        deployments: all
vars:
  - name: PYTHON_ENV
    question: Server environment to run in.
    default: "dev"
