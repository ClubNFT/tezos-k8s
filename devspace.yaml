version: v1beta9
deployments:
  - name: chain
    namespace: tqtezos
    kubectl:
      manifests:
        - ./mkchain-devspace.yaml

dev:
  logs:
    disabled: true
  autoReload:
    deployments:
      - chain
    paths:
      - ./tqchain/deployment/*

hooks:
  - command: sh
    args:
      - -c
      - "mkchain ${ACTION} ${CHAIN_NAME} ${CHAIN_ARGS} > mkchain-devspace.yaml"
    when:
      before:
        deployments: all

vars:
  - name: ACTION
    question: Mkchain action (create or invite)
    default: "create"
    source: env
  - name: CHAIN_NAME
    question: Name of the chain as passed to generate-constants
    default: "devspace"
    source: env
  - name: CHAIN_ARGS
    default: ""
    source: env

profiles:
  - name: zerotier
    replace:
      images:
        zerotier:
          image: tezos-zerotier
          dockerfile: ./docker/zerotier/Dockerfile
          context: ./docker/zerotier
    patches:
      - op: add
        path: dev.autoReload.images
        value:
          - zerotier
